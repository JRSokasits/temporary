<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Login page</title>
    <link rel = "stylesheet" href = "styles.css">
    <style>
    </style>
</head>
<body style = "text-align:center;">
    <header>Carnegie Mellon Tech Bridge Coding Boot Camp</header>
    <h2>User Login</h2>
    <p>Log into your account.</p>
  <form id="login-form" onsubmit="return false;">
    <input type="text" id="username" placeholder="username"><br>
    <span id="usernameError";></span>

    <input type="password" id="password" placeholder="password"><br>
    <span id="passwordError";></span><br>

    <!-- Buttons -->
    <button type="button" onclick="login()">login</button>
    <br>
    <br>
    <button type="button" onclick="goToMainPage()">main page</button>
    <button type="button" onclick="goToStoriesPage()">stories page</button>
  </form>    
  
  <script>
      async function login() {
        const username = document.getElementById("username").value.trim();
        const password = document.getElementById("password").value.trim();

        document.getElementById("usernameError").innerText = "";
        document.getElementById("passwordError").innerText = "";

        if (username === "" || password ==="") {
          if (username === "") {
          document.getElementById("usernameError").innerText = "Please enter a username";
        }
          if (password ==="") {
            document.getElementById("passwordError").innerText = "Please enter a password"          
        }
          return;
        }

        try {
          const response = await fetch("http://localhost:3000/api/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username, password })
          });

          const result = await response.json();
          if (result.success) {
            window.location.href = "postform.html";
          } else {
            document.getElementById("passwordError").innerText = result.message || "Invalid username or password";
        }
      } catch (error) {
        console.error("Login error:", error);
        document.getElementById("passwordError").innerText = "Server error. Try again later.";
      }
    }
      
      function goToStoriesPage() {
        window.location.href ="display.html";
      }
      function goToMainPage() {
        window.location.href ="index.html";
      }  
    </script>
    <br>
    
    <footer>Carnegie Mellon Tech Bridge Coding Boot Camp</footer>
</body>
</html>